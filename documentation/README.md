# Смарт-контракты для управления токенами и торговли

Этот репозиторий содержит набор смарт-контрактов, написанных на Solidity, для управления токенами, торговли и управления доверительными отношениями между пользователями и управляющими. Контракты включают функциональность для выпуска (mint), сжигания (burn) и перевода токенов, а также для управления доверительными соглашениями между пользователями и управляющими для торговли.

## Содержание
1. [Обзор контрактов](#обзор-контрактов)
   - [MockERC20](#mockerc20)
   - [ETH](#eth)
   - [USDS](#usds)
   - [Swap](#swap)
   - [Manager](#manager)
   - [UserRegistry](#userregistry)
2. [Использование](#использование)
   - [Развертывание контрактов](#развертывание-контрактов)
   - [Создание доверительного соглашения](#создание-доверительного-соглашения)
   - [Торговля токенами](#торговля-токенами)
3. [События](#события)
4. [Лицензия](#лицензия)
5. [Вклад в проект](#вклад-в-проект)
6. [Контакты](#контакты)

## Обзор контрактов

### MockERC20
Это базовая реализация токена стандарта ERC-20, которая используется как основа для других токенов. Включает стандартные функции ERC-20, такие как `transfer`, `approve` и `transferFrom`.

#### Основные функции:
- **`transfer(address to, uint256 value)`**: Переводит токены с адреса отправителя на указанный адрес.
- **`approve(address spender, uint256 value)`**: Разрешает указанному адресу (`spender`) снимать токены с адреса отправителя.
- **`transferFrom(address from, address to, uint256 value)`**: Переводит токены с одного адреса на другой, если у вызывающего есть достаточное разрешение (allowance).

### ETH
Этот контракт представляет токен, основанный на Ethereum (ETH), и расширяет функциональность контракта `MockERC20`. Включает дополнительные функции для выпуска и сжигания токенов.

#### Основные функции:
- **`mint(address to, uint256 amount)`**: Выпускает новые токены и назначает их на указанный адрес. Доступно только владельцу контракта.
- **`burn(uint256 amount)`**: Сжигает токены с адреса отправителя, уменьшая общее предложение токенов.

### USDS
Этот контракт представляет стейблкоин (USDS) и также расширяет функциональность контракта `MockERC20`. Включает аналогичные функции для выпуска и сжигания токенов, как и в контракте `ETH`.

#### Основные функции:
- **`mint(address to, uint256 amount)`**: Выпускает новые токены и назначает их на указанный адрес. Доступно только владельцу контракта.
- **`burn(uint256 amount)`**: Сжигает токены с адреса отправителя, уменьшая общее предложение токенов.

### Swap
Этот контракт обеспечивает обмен токенов между двумя токенами (USDS и ETH) на основе фиксированного обменного курса.

#### Основные функции:
- **`swapExactTokensForTokens(uint amountIn, uint amountOutMin, address tokenIn, address tokenOut, address to)`**: Обменивает указанное количество одного токена на другой на основе обменного курса. Возвращает количество полученных токенов.

### Manager
Этот контракт управляет доверительными соглашениями между пользователями и управляющими, позволяя пользователям вносить токены и авторизовывать управляющих для торговли от их имени.

#### Основные функции:
- **`createTrust(address manager, uint256 durationInDays, uint256 _commission)`**: Создает доверительное соглашение между пользователем и управляющим. Указывается срок действия соглашения и комиссия управляющего.
- **`depositTokens(address token, uint256 amount)`**: Вносит токены в контракт для торговли. Доступно только для активных доверительных соглашений.
- **`tradeTokens(address tokenIn, address tokenOut, uint amountIn, uint amountOutMin, address user)`**: Позволяет управляющему торговать токенами от имени пользователя. Доступно только для активных доверительных соглашений.
- **`stopTrading(address user, address manager)`**: Останавливает торговлю и распределяет средства в соответствии с доверительным соглашением. Комиссия управляющего вычитается из прибыли.

### UserRegistry
Этот контракт используется для регистрации пользователей и хранения информации о них, включая их адреса и комиссии.

#### Основные функции:
- **`addUser(address _userAddress, uint256 _commission)`**: Добавляет нового пользователя в реестр.
- **`getUsers()`**: Возвращает список всех зарегистрированных пользователей.

## Использование

### Развертывание контрактов
1. Разверните контракт `MockERC20` как основу для ваших токенов.
2. Разверните контракты `ETH` и `USDS`, передав начальное предложение токенов в конструктор.
3. Разверните контракт `Swap`, указав адреса токенов `USDS` и `ETH`, а также обменный курс.
4. Разверните контракт `Manager`, передав адрес контракта `Swap`, адреса токенов и обменный курс.
5. Разверните контракт `UserRegistry` для регистрации пользователей.

### Создание доверительного соглашения
1. Пользователь вызывает функцию `createTrust` в контракте `Manager`, указывая адрес управляющего, срок действия доверительного соглашения и комиссию.
2. Пользователь вносит токены в контракт с помощью функции `depositTokens`.

### Торговля токенами
1. Управляющий вызывает функцию `tradeTokens` в контракте `Manager`, чтобы торговать токенами от имени пользователя.
2. Управляющий может остановить торговлю, вызвав функцию `stopTrading`, которая распределит средства в соответствии с доверительным соглашением.

## События
- **`TokensDeposited`**: Вызывается, когда токены вносятся в контракт.
- **`TradingEnabled`**: Вызывается, когда торговля активируется для пользователя.
- **`TradingStopped`**: Вызывается, когда торговля останавливается.
- **`TradingStarted`**: Вызывается, когда торговля начинается.

## Лицензия
Этот проект лицензирован под MIT License. Подробнее см. в файле [LICENSE](LICENSE).

## Вклад в проект
Мы приветствуем вклад в проект! Пожалуйста, создайте issue или отправьте pull request с предложениями по улучшению или исправлению ошибок.

## Контакты
По любым вопросам или для получения поддержки, пожалуйста, свяжитесь с владельцем репозитория.